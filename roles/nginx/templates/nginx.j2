#!/bin/sh
#
# Simple nginx init.d script conceived to work on Linux systems
# as it does use of the /proc filesystem.


### BEGIN INIT INFO
# Provides:     nginx
# Default-Start:        2 3 4 5
# Default-Stop:         0 1 6
# Short-Description:    nginx
# Description:          nginx
### END INIT INFO


BASE_DIR="{{ apps_base_dir }}/nginx/sbin/"

case "$1" in
    start)
        ps -ef | grep $BASE_DIR | grep -v grep | awk '{print $2}' | xargs -r kill -9 ;
        ps -ef | grep "nginx: worker process" | grep -v grep | awk '{print $2}' | xargs -r kill -9 ;
        sleep 3;
        $BASE_DIR/nginx
        ;;
    stop)
        ps -ef | grep $BASE_DIR | grep -v grep | awk '{print $2}' | xargs -r kill -9 ;
        ;;
    *)
        echo "Please use start or stop as first argument"
        ;;
esac
