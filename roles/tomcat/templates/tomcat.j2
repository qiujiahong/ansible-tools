#!/bin/sh
#
# Simple Redis init.d script conceived to work on Linux systems
# as it does use of the /proc filesystem.

### BEGIN INIT INFO
# Provides:     redis_6379
# Default-Start:        2 3 4 5
# Default-Stop:         0 1 6
# Short-Description:    Redis data structure server
# Description:          Redis data structure server. See https://redis.io
### END INIT INFO

# EXEC=/usr/local/bin/redis-server
# EXEC={{ apps_base_dir }}/redis/bin/redis-server

# CLIEXEC=/usr/local/bin/redis-cli
# CLIEXEC={{ apps_base_dir }}/redis/bin/redis-cli

# PIDFILE=/var/run/redis_${REDISPORT}.pid
# CONF="/etc/redis/${REDISPORT}.conf"
# CONF="{{ apps_base_dir }}/redis/conf/${REDISPORT}.conf"

BASE_DIR="{{ apps_base_dir }}/apache-tomcat-8.5.42/bin/"

case "$1" in
    start)
        ps -ef | grep apache-tomcat-8.5.42 | grep -v grep | awk '{print $2}' | xargs -r kill -9 ;
        sleep 3;
        cd $BASE_DIR
        ./startup.sh 
        # if [ -f $PIDFILE ]
        # then
        #         echo "$PIDFILE exists, process is already running or crashed"
        # else
        #         echo "Starting Redis server..."
        #         $EXEC $CONF
        # fi
        ;;
    stop)
        ps -ef | grep tomcat | grep -v grep | awk '{print $2}' | xargs -r kill -9 ;
        # if [ ! -f $PIDFILE ]
        # then
        #         echo "$PIDFILE does not exist, process is not running"
        # else
        #         PID=$(cat $PIDFILE)
        #         echo "Stopping ..."
        #         $CLIEXEC -p $REDISPORT shutdown
        #         while [ -x /proc/${PID} ]
        #         do
        #             echo "Waiting for Redis to shutdown ..."
        #             sleep 1
        #         done
        #         echo "Redis stopped"
        # fi
        ;;
    *)
        echo "Please use start or stop as first argument"
        ;;
esac
